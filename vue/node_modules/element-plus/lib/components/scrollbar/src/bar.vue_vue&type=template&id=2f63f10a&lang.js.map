{"version":3,"file":"bar.vue_vue&type=template&id=2f63f10a&lang.js","sources":["../../../../../../packages/components/scrollbar/src/bar.vue?vue&type=template&id=2f63f10a&lang.js"],"sourcesContent":["<template>\n  <transition name=\"el-scrollbar-fade\">\n    <div\n      v-show=\"always || visible\"\n      ref=\"instance\"\n      :class=\"['el-scrollbar__bar', 'is-' + bar.key]\"\n      @mousedown=\"clickTrackHandler\"\n    >\n      <div\n        ref=\"thumb\"\n        class=\"el-scrollbar__thumb\"\n        :style=\"thumbStyle\"\n        @mousedown=\"clickThumbHandler\"\n      ></div>\n    </div>\n  </transition>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  inject,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n} from 'vue'\nimport { off, on } from '@element-plus/utils/dom'\nimport { BAR_MAP, renderThumbStyle } from './util'\n\nimport type { Ref } from 'vue'\nimport type { Nullable } from '@element-plus/utils/types'\n\nexport default defineComponent({\n  name: 'Bar',\n  props: {\n    vertical: Boolean,\n    size: String,\n    move: Number,\n    ratio: Number,\n    always: Boolean,\n  },\n  setup(props) {\n    const instance = ref(null)\n    const thumb = ref(null)\n    const scrollbar = inject('scrollbar', {} as Ref<Nullable<HTMLElement>>)\n    const wrap = inject('scrollbar-wrap', {} as Ref<Nullable<HTMLElement>>)\n    const bar = computed(\n      () => BAR_MAP[props.vertical ? 'vertical' : 'horizontal']\n    )\n    const barStore = ref({})\n    const cursorDown = ref(null)\n    const cursorLeave = ref(null)\n    const visible = ref(false)\n    let onselectstartStore = null\n\n    const offsetRatio = computed(() => {\n      // offsetRatioX = original width of thumb / current width of thumb / ratioX\n      // offsetRatioY = original height of thumb / current height of thumb / ratioY\n      // instance height = wrap height - GAP\n      return (\n        instance.value[bar.value.offset] ** 2 /\n        wrap.value[bar.value.scrollSize] /\n        props.ratio /\n        thumb.value[bar.value.offset]\n      )\n    })\n\n    const clickThumbHandler = (e: MouseEvent) => {\n      // prevent click event of middle and right button\n      e.stopPropagation()\n      if (e.ctrlKey || [1, 2].includes(e.button)) {\n        return\n      }\n      window.getSelection().removeAllRanges()\n      startDrag(e)\n      barStore.value[bar.value.axis] =\n        e.currentTarget[bar.value.offset] -\n        (e[bar.value.client] -\n          (e.currentTarget as HTMLElement).getBoundingClientRect()[\n            bar.value.direction\n          ])\n    }\n\n    const clickTrackHandler = (e: MouseEvent) => {\n      const offset = Math.abs(\n        (e.target as HTMLElement).getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]\n      )\n      const thumbHalf = thumb.value[bar.value.offset] / 2\n      const thumbPositionPercentage =\n        ((offset - thumbHalf) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n\n      wrap.value[bar.value.scroll] =\n        (thumbPositionPercentage * wrap.value[bar.value.scrollSize]) / 100\n    }\n\n    const startDrag = (e: MouseEvent) => {\n      e.stopImmediatePropagation()\n      cursorDown.value = true\n      on(document, 'mousemove', mouseMoveDocumentHandler)\n      on(document, 'mouseup', mouseUpDocumentHandler)\n      onselectstartStore = document.onselectstart\n      document.onselectstart = () => false\n    }\n\n    const mouseMoveDocumentHandler = (e: MouseEvent) => {\n      if (cursorDown.value === false) return\n      const prevPage = barStore.value[bar.value.axis]\n\n      if (!prevPage) return\n\n      const offset =\n        (instance.value.getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]) *\n        -1\n      const thumbClickPosition = thumb.value[bar.value.offset] - prevPage\n      const thumbPositionPercentage =\n        ((offset - thumbClickPosition) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n      wrap.value[bar.value.scroll] =\n        (thumbPositionPercentage * wrap.value[bar.value.scrollSize]) / 100\n    }\n\n    const mouseUpDocumentHandler = () => {\n      cursorDown.value = false\n      barStore.value[bar.value.axis] = 0\n      off(document, 'mousemove', mouseMoveDocumentHandler)\n      off(document, 'mouseup', mouseUpDocumentHandler)\n      document.onselectstart = onselectstartStore\n      if (cursorLeave.value) {\n        visible.value = false\n      }\n    }\n\n    const thumbStyle = computed(() =>\n      renderThumbStyle({\n        size: props.size,\n        move: props.move,\n        bar: bar.value,\n      })\n    )\n\n    const mouseMoveScrollbarHandler = () => {\n      cursorLeave.value = false\n      visible.value = !!props.size\n    }\n\n    const mouseLeaveScrollbarHandler = () => {\n      cursorLeave.value = true\n      visible.value = cursorDown.value\n    }\n\n    onMounted(() => {\n      on(scrollbar.value, 'mousemove', mouseMoveScrollbarHandler)\n      on(scrollbar.value, 'mouseleave', mouseLeaveScrollbarHandler)\n    })\n\n    onBeforeUnmount(() => {\n      off(document, 'mouseup', mouseUpDocumentHandler)\n      off(scrollbar.value, 'mousemove', mouseMoveScrollbarHandler)\n      off(scrollbar.value, 'mouseleave', mouseLeaveScrollbarHandler)\n    })\n\n    return {\n      instance,\n      thumb,\n      bar,\n      clickTrackHandler,\n      clickThumbHandler,\n      thumbStyle,\n      visible,\n    }\n  },\n})\n</script>\n"],"names":["_createBlock","_createElementVNode"],"mappings":";;;;;;;0BACEA,kCAAY,MAAK;yBACf;yBAAAC;QAEE,KAAI;AAAA,QACH,wDAAqC,SAAI;AAAA,QACzC,oDAAW;;QAEZA;UACE,KAAI;AAAA,UACJ,OAAM;AAAA,UACL,0BAAO;UACP,oDAAW;;;oBATN,eAAU;;;;;;;;;"}
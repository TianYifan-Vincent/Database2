{"version":3,"file":"bar.vue_vue&type=script&lang.mjs","sources":["../../../../../../packages/components/scrollbar/src/bar.vue"],"sourcesContent":["<template>\n  <transition name=\"el-scrollbar-fade\">\n    <div\n      v-show=\"always || visible\"\n      ref=\"instance\"\n      :class=\"['el-scrollbar__bar', 'is-' + bar.key]\"\n      @mousedown=\"clickTrackHandler\"\n    >\n      <div\n        ref=\"thumb\"\n        class=\"el-scrollbar__thumb\"\n        :style=\"thumbStyle\"\n        @mousedown=\"clickThumbHandler\"\n      ></div>\n    </div>\n  </transition>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  inject,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n} from 'vue'\nimport { off, on } from '@element-plus/utils/dom'\nimport { BAR_MAP, renderThumbStyle } from './util'\n\nimport type { Ref } from 'vue'\nimport type { Nullable } from '@element-plus/utils/types'\n\nexport default defineComponent({\n  name: 'Bar',\n  props: {\n    vertical: Boolean,\n    size: String,\n    move: Number,\n    ratio: Number,\n    always: Boolean,\n  },\n  setup(props) {\n    const instance = ref(null)\n    const thumb = ref(null)\n    const scrollbar = inject('scrollbar', {} as Ref<Nullable<HTMLElement>>)\n    const wrap = inject('scrollbar-wrap', {} as Ref<Nullable<HTMLElement>>)\n    const bar = computed(\n      () => BAR_MAP[props.vertical ? 'vertical' : 'horizontal']\n    )\n    const barStore = ref({})\n    const cursorDown = ref(null)\n    const cursorLeave = ref(null)\n    const visible = ref(false)\n    let onselectstartStore = null\n\n    const offsetRatio = computed(() => {\n      // offsetRatioX = original width of thumb / current width of thumb / ratioX\n      // offsetRatioY = original height of thumb / current height of thumb / ratioY\n      // instance height = wrap height - GAP\n      return (\n        instance.value[bar.value.offset] ** 2 /\n        wrap.value[bar.value.scrollSize] /\n        props.ratio /\n        thumb.value[bar.value.offset]\n      )\n    })\n\n    const clickThumbHandler = (e: MouseEvent) => {\n      // prevent click event of middle and right button\n      e.stopPropagation()\n      if (e.ctrlKey || [1, 2].includes(e.button)) {\n        return\n      }\n      window.getSelection().removeAllRanges()\n      startDrag(e)\n      barStore.value[bar.value.axis] =\n        e.currentTarget[bar.value.offset] -\n        (e[bar.value.client] -\n          (e.currentTarget as HTMLElement).getBoundingClientRect()[\n            bar.value.direction\n          ])\n    }\n\n    const clickTrackHandler = (e: MouseEvent) => {\n      const offset = Math.abs(\n        (e.target as HTMLElement).getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]\n      )\n      const thumbHalf = thumb.value[bar.value.offset] / 2\n      const thumbPositionPercentage =\n        ((offset - thumbHalf) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n\n      wrap.value[bar.value.scroll] =\n        (thumbPositionPercentage * wrap.value[bar.value.scrollSize]) / 100\n    }\n\n    const startDrag = (e: MouseEvent) => {\n      e.stopImmediatePropagation()\n      cursorDown.value = true\n      on(document, 'mousemove', mouseMoveDocumentHandler)\n      on(document, 'mouseup', mouseUpDocumentHandler)\n      onselectstartStore = document.onselectstart\n      document.onselectstart = () => false\n    }\n\n    const mouseMoveDocumentHandler = (e: MouseEvent) => {\n      if (cursorDown.value === false) return\n      const prevPage = barStore.value[bar.value.axis]\n\n      if (!prevPage) return\n\n      const offset =\n        (instance.value.getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]) *\n        -1\n      const thumbClickPosition = thumb.value[bar.value.offset] - prevPage\n      const thumbPositionPercentage =\n        ((offset - thumbClickPosition) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n      wrap.value[bar.value.scroll] =\n        (thumbPositionPercentage * wrap.value[bar.value.scrollSize]) / 100\n    }\n\n    const mouseUpDocumentHandler = () => {\n      cursorDown.value = false\n      barStore.value[bar.value.axis] = 0\n      off(document, 'mousemove', mouseMoveDocumentHandler)\n      off(document, 'mouseup', mouseUpDocumentHandler)\n      document.onselectstart = onselectstartStore\n      if (cursorLeave.value) {\n        visible.value = false\n      }\n    }\n\n    const thumbStyle = computed(() =>\n      renderThumbStyle({\n        size: props.size,\n        move: props.move,\n        bar: bar.value,\n      })\n    )\n\n    const mouseMoveScrollbarHandler = () => {\n      cursorLeave.value = false\n      visible.value = !!props.size\n    }\n\n    const mouseLeaveScrollbarHandler = () => {\n      cursorLeave.value = true\n      visible.value = cursorDown.value\n    }\n\n    onMounted(() => {\n      on(scrollbar.value, 'mousemove', mouseMoveScrollbarHandler)\n      on(scrollbar.value, 'mouseleave', mouseLeaveScrollbarHandler)\n    })\n\n    onBeforeUnmount(() => {\n      off(document, 'mouseup', mouseUpDocumentHandler)\n      off(scrollbar.value, 'mousemove', mouseMoveScrollbarHandler)\n      off(scrollbar.value, 'mouseleave', mouseLeaveScrollbarHandler)\n    })\n\n    return {\n      instance,\n      thumb,\n      bar,\n      clickTrackHandler,\n      clickThumbHandler,\n      thumbStyle,\n      visible,\n    }\n  },\n})\n</script>\n"],"names":[],"mappings":"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"}